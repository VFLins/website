<!doctype html>
<meta charset="utf-8">
<link rel="stylesheet" href="../../static/pygments.css">
<link rel="stylesheet" href="../../static/style.css">
<script src="../../static/toggle-theme.js"></script>
<title>Concluindo a primeira vers√£o do front-end do Cashd com Toga ‚Äî Vitor F. Lins</title>
<body>
    <header>
        <h1><b>Vitor F. Lins</b></h1>
        <nav>
            <ul class="nav navbar-nav">
                <li>
                    <a href="../../">In√≠cio</a>
                </li>
                
                    <li class="active"><a href="../">Blog</a></li>
                
                    <li><a href="../../projetos/">Projetos</a></li>
                
                    <li><a href="../../sobre/">Sobre mim</a></li>
                
                <li style="color:var(--page-text);float:right"><input type="checkbox" id="theme-toggle"><label for="theme-toggle">Tema claro</label></li>
            </ul>
        </nav>
    </header>
    <div class="page">
        
  
  <div class="blog-post">
  
    <h1>Concluindo a primeira vers√£o do front-end do Cashd com Toga</h1>
  
  <p class="meta">2025-08-06
     |
        
            <code><a href="../../tag/Cashd/">Cashd</a></code>
        
            <code><a href="../../tag/Novo_recurso/">Novo recurso</a></code>
        
    
  </p>
  <blockquote class="callout-success">

    <p><b>‚úÖ O <i>layout</i> inicial do aplicativo do Cashd est√° finalizado</b></p>

    <p>Agora temos formul√°rios em duas colunas, al√©m de espa√ßamentos e alinhamentos
    padronizados. Isto conclui a segunda tarefa de: <a href="../2025-06-16/">"Melhorar
    interface, aumentar a largura do conte√∫do e organizar inputs em duas colunas"</a>.</p>

</blockquote><h2>Introduzindo <code>FormHandler</code></h2>
<p>Tr√™s classes foram adicionadas para lidar com a cria√ß√£o din√¢mica de formul√°rios:</p>
<ol>
<li><code>FormField</code>, que representa um campo, o menor elemento de um formul√°rio, e cont√©m
um dos <em>inputs</em> que ser√£o fornecidos pelo usu√°rio;</li>
<li><code>FormRow</code>, uma combina√ß√£o de campos dispostos horizontalmente, ele deve controlar a
quantidade de colunas exibidas, a largura do formul√°rio, e a largura m√°xima de cada um
de seus campos;</li>
<li><code>FormHandler</code>, possui uma propriedade <code>full_contents</code> onde ficam os conte√∫dos de todos
os seus <code>FormRow</code>. Ele oferece uma interface para os dados preenchidos pelo usu√°rio e
lida com a inclus√£o e remo√ß√£o de campos, al√©m dos eventos <code>on_change</code>, <code>on_lose_focus</code>,
etc.</li>
</ol>
<h3>Os campos do formul√°rio</h3>
<p>Uma inst√¢ncia da nova classe <code>FormField</code> retorna um <code>toga.Box</code> modificado, essencialmente
com tr√™s elementos:</p>
<ol>
<li>Um r√≥tulo (<code>label</code>), com um t√≠tulo para o campo;</li>
<li>Um <em>widget</em> de <em>input</em> (<code>input_widget</code>), onde o usu√°rio vai inserir a informa√ß√£o;</li>
<li>Uma descri√ß√£o opcional (<code>annotation</code>), um texto curto abaixo do <code>input_widget</code> com
mais informa√ß√µes para o usu√°rio.</li>
</ol>
<p>Outro atributo tamb√©m importante, mas n√£o essencial √© o <code>id</code>, que √© usado para
identificar cada <em>input</em> com uma <em>string</em> √∫nica, o <code>FormField</code> definido com o id
<code>"my_field"</code> poder√° ser obtido do <code>FormHandler</code>:</p>
<div class="hll"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">cashd.wigets.form</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">FormHandler</span><span class="p">,</span>
    <span class="n">FormField</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">toga</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextInput</span>

<span class="n">form</span> <span class="o">=</span> <span class="n">FormHandler</span><span class="p">()</span>
<span class="n">field</span> <span class="o">=</span> <span class="n">FormField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;My field&quot;</span><span class="p">,</span>
    <span class="n">input_widget</span><span class="o">=</span><span class="n">TextInput</span><span class="p">(),</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;my_field&quot;</span><span class="p">,</span>
    <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">form</span><span class="o">.</span><span class="n">add_fields</span><span class="p">([</span><span class="n">field</span><span class="p">])</span>
<span class="sd">&quot;&quot;&quot;Adicionar o FormField ao FormHandler.&quot;&quot;&quot;</span>

<span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;my_field&quot;</span><span class="p">]</span>
<span class="sd">&quot;&quot;&quot;Acessar o FormField.&quot;&quot;&quot;</span>

<span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;my_field&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">input_widget</span><span class="o">.</span><span class="n">value</span>
<span class="sd">&quot;&quot;&quot;Dado inserido pelo usu√°rio.&quot;&quot;&quot;</span>
</pre></div>
<p>Repare que tamb√©m existe um par√¢metro <code>required</code> ao definir o <code>FormField</code>, ele ser√°
explicado mais adiante, no t√≥pico "O manipulador de formul√°rios". Mas antes, vamos falar
sobre o que se espera das linhas do formul√°rio.</p>
<h3>As linhas do formul√°rio</h3>
<p>Atualmente, para fim de simplicidade e velocidade de implementa√ß√£o, <code>FormRow</code> apenas
possuem uma largura fixa, n√£o se adaptando √† largura da janela, e n√£o aceita mais que
dois campos, com uma largura m√°xima fixada.</p>
<p>A largura dos campos atualmente est√° sendo gerenciada fora de <code>FormRow</code>, com a fun√ß√£o
<code>cashd.style.user_input()</code>, que recebe um tipo de <em>input</em> como <code>toga.TextInput</code> e retorna
o <code>toga.style.Pack</code> padr√£o correspondente.</p>
<p>Mas no caso de uma implementa√ß√£o para dispositivos m√≥veis, onde a largura da tela depende
da orienta√ß√£o do aparelho, seria necess√°rio que <code>FormHandler</code> tivesse um 
<em>event listener</em>, que automaticamente ativaria a rotina de reorganiza√ß√£o dos campos em um
novo conjunto de <code>FormRow</code>, aumentando ou diminuindo a quantidade de <em>inputs</em> por linha.</p>
<h3>O manipulador de formul√°rios</h3>
<p>O <code>FormHandler</code> √© respons√°vel por organizar os campos do formul√°rio em uma grade
orientada √† linhas de <em>inputs</em>. Ele tamb√©m √© respons√°vel por passar uma fun√ß√£o que se
ative sempre que algum tipo de intera√ß√£o ocorre com o input, como <code>on_change</code> ou
<code>on_lose_focus</code>, todos os campos recebem a mesma fun√ß√£o, portanto, para oferecer
tratamentos distintos para cada uma, seria necess√°rio acessar os metadados de cada campo.</p>
<p>Atualmente, para as necessidades do <a href="../../tag/Cashd">Cashd</a>, o √∫nico metadado que precisa ser acessado
√© o fato de o preenchimento de determinado campo √© obrigat√≥rio ou n√£o, isto √© passado
para cada <code>FormField</code> individualmente, com o valor padr√£o <code>False</code>. Ainda √© poss√≠vel
verificar se todos os campos obrigat√≥rios foram preenchidos usando o m√©todo
<code>required_fields_are_filled()</code>:</p>
<div class="hll"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">cashd.widgets.form</span><span class="w"> </span><span class="kn">import</span> <span class="n">FormHandler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cashd.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_default_customer</span>

<span class="n">customer</span> <span class="o">=</span> <span class="n">get_default_customer</span><span class="p">()</span>
<span class="sd">&quot;&quot;&quot;Inst√¢ncia de cashd.data.tbl_clientes</span>
<span class="sd">com alguns valores preenchidos.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">FormHandler</span><span class="p">()</span>

<span class="n">form</span><span class="o">.</span><span class="n">add_table_fields</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">customer</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Adicionar campos da tabela &#39;clientes&#39;.&quot;&quot;&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_change_form</span><span class="p">(</span><span class="n">widget</span><span class="p">):</span>
    <span class="n">required_filled</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">required_fields_are_filled</span><span class="p">()</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verificar se todos os campos obrigat√≥rios</span>
<span class="sd">    foram preenchidos.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">required_filled</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Required fields are filled!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some required fields are still empty.&quot;</span><span class="p">)</span>

<span class="n">form</span><span class="o">.</span><span class="n">on_change</span> <span class="o">=</span> <span class="n">on_change_form</span>
</pre></div>
<p>Veja que tamb√©m podemos preencher um formul√°rio com todos os campos da tabela clientes
rapidamente, isto tamb√©m preenche os campos com os valores de <code>customer</code>, define o <code>id</code>
de cada campo com o nome de sua respectiva coluna no banco de dados, o <code>label</code> com o
respectivo <code>display_name</code> definido em <code>cashd.data.tbl_clientes</code>, e o metadado <code>required</code>
de acordo com o [[2025-07-08#1.1 A valida√ß√£o de dados agora √© feita pelo <code>sqlalchemy</code>|tipo de dados declarado ao SQLAlchemy]].</p>
<p>O exemplo de c√≥digo acima funciona adequadamente quando recebe uma inst√¢ncia de
<code>cashd.data.tbl_clientes</code>, mas atualmente ainda n√£o consegue lidar com
<code>cashd.data.tbl_transacoes</code>, porque ainda n√£o foi instru√≠do sobre como lidar com campos
de data.</p>
<h2>Melhorias visuais e de experi√™ncia do usu√°rio</h2>
<p>Todas as telas exceto a de estat√≠sticas passaram por melhorias visuais, vamos mostrar
por ordem:</p>
<h3>Tela inicial</h3>
<p>A tela inicial n√£o possui mais os tr√™s bot√µes, em que cada um levaria √† uma intera√ß√£o
diferente, agora, em vez disso, apenas um bot√£o leva para um <code>toga.OptionContainer</code>,
que mostra um conjunto de abas que mostra todas as intera√ß√µes poss√≠veis com o usu√°rios
selecionado.</p>
<p><img src="cashd-selecionar_cliente-winforms.png" alt="Tela inicial do Cahsd, &quot;Selecionar cliente&quot;."></p>
<p>Ao clicar no √≠cone de usu√°rio com uma caneta, vamos para uma tela com todas as op√ß√µes
que antes estavam dispostas em bot√µes, agora dispostas em abas. Todas as intera√ß√µes
feitas dentro deste conjunto de abas ser√£o aplicadas ao usu√°rio informado na parte
superior.</p>
<p><img src="cashd-transacoes_nova_transacao-winforms.png" alt="Tela inicial do Cashd, &quot;Inserir transa√ß√£o&quot;."></p>
<p>Esta √© a tela de hist√≥rico de transa√ß√µes:</p>
<p><img src="cashd-transacoes_historico-winforms.png" alt="Tela inicial do Cashd, &quot;Hist√≥rico de transa√ß√µes&quot;."></p>
<p>Para habilitar o bot√£o "Remover transa√ß√£o", o usu√°rio deve primeiro selecionar
alguma linha da tabela, ao remover uma transa√ß√£o, o usu√°rio recebe um di√°logo de
confirma√ß√£o, que informa qual transa√ß√£o ser√° exclu√≠da. Ao confirmar, esta transa√ß√£o ser√°
removida, e as informa√ß√µes na parte superior ser√£o atualizadas.</p>
<p><img src="cashd-confirma_remover_transacao-winforms.png" alt="Di√°logo de confirma√ß√£o, &quot;Remover transa√ß√£o?&quot;."></p>
<p>J√° na aba "Informa√ß√µes do cliente" √© poss√≠vel ver as informa√ß√µes de cadastro atuais do
cliente selecionado, e modific√°-las:</p>
<p><img src="cashd-transacoes_informacoes-winforms.png" alt="Tela inicial do Cashd, informa√ß√µes do cliente selecionado."></p>
<p>A tela acima j√° segue o <em>layout</em> padr√£o de formul√°rios definido pelo <code>FormHandler</code>
mencionado anteriormente, mas este n√£o √© o √∫nico lugar onde esse <em>layout</em> √© aplicado.</p>
<h3>Telas "Novo cliente" e "Configura√ß√µes"</h3>
<p>As telas "Novo Cliente" e "Configura√ß√µes" tamb√©m seguem o novo <em>layout</em> de duas colunas
implementados com <code>FormHandler</code>:</p>
<p><img src="cashd-novo_cliente-winforms.png" alt="Tela &quot;Novo cliente&quot; do Cahsd."></p>
<p><img src="cashd-configuracoes-winforms.png" alt="Tela de Configura√ß√µes do Cashd."></p>
<h2>Migrando as duas vers√µes do Cashd para um √∫nico reposit√≥rio</h2>
<p>At√© o momento, os dois projetos foram desenvolvidos em reposit√≥rios separados, um aberto
chamado <code>cashd</code>, onde est√° o projeto desenvolvido com Taipy, que pode servir um √∫nico app
web para uma rede local, que pode ser acessado apenas no pr√≥prio computador, ou em
qualquer n√∫mero de computadores conectados na rede local. E outro reposit√≥rio
<code>cashd-cross</code>, fechado, onde eu desenvolvo o aplicativo <em>stand-alone</em> e independente de
rede, que pode ser compilado para qualquer plataforma atual, seja <em>mobile</em> ou para
computador de mesa (<em>cross-platform</em>, da√≠ o nome).</p>
<p>A pr√≥xima coisa a ser feita neste projeto √© unir ambas as implementa√ß√µes em um s√≥
reposit√≥rio, reservando um
<em><a href="https://packaging.python.org/en/latest/guides/packaging-namespace-packages/#native-namespace-packages">namespace</a></em>
para cada projeto. Al√©m disso, existem outras coisas pertinentes para se adicionar √†
lista de coisas a fazer:</p>
<blockquote><p>üìù <strong>Tarefa pendente:</strong> Agregar os reposit√≥rios <code>cashd</code> e <code>cashd-cross</code> + Adaptar <code>cashd</code> com Taipy para agir como servidor.</p>
<ul>
<li>Preparar o primeiro <em>release</em> do <code>cashd-cross</code> e uma rotina p√∫blica de <em>build</em> para os seus bin√°rios;</li>
<li>Mudar os nomes de cada projeto para <code>cashd-server</code> e <code>cashd-local</code>;</li>
<li>Mudar o foco do <code>cashd-server</code> para agir como servidor, em vez de fazer parecer um programa local usando um <em>webview</em>.</li>
</ul>
</blockquote>

  </div>


    </div>
    <footer>
        &copy; Copyright 2025 by Vitor F. Lins.
    </footer>
</body>
